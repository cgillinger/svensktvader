<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Svenskt v√§der</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Inkludera Weather Icons korrekt -->
  <link rel="stylesheet" href="weather-icons/css/weather-icons.min.css">
  <link rel="stylesheet" href="weather-icons/css/weather-icons-wind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="top-bar">
        <h1>Svenskt v√§der</h1>
        <button id="settings-button" class="settings-button" aria-label="Inst√§llningar">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </header>

    <main>
      <div class="loading" id="loading-indicator">
        <span class="wi wi-day-cloudy loading-icon"></span>
        <span>Laddar v√§derdata...</span>
      </div>

      <div class="weather-container" id="weather-display" style="display: none;">
        <!-- Platsnamn ovanf√∂r temperatur -->
        <div class="location-display">
          <h2 id="selected-location-name">Stockholm</h2>
        </div>
        
        <div class="current-weather">
          <div class="weather-icon">
            <i id="current-weather-icon" class="wi wi-day-sunny"></i>
          </div>
          <div class="current-temp">
            <span id="current-temp-value">--</span>¬∞C
          </div>
          <div class="weather-description" id="weather-description">
            Uppeh√•ll
          </div>
          
          <!-- Luftfuktighet flyttad till den bl√• panelen -->
          <div class="humidity-display">
            <i class="wi wi-humidity"></i>
            <span id="humidity">--%</span>
          </div>
        </div>

        <!-- UV-index panel direkt under temperaturen -->
        <div class="uv-index-bar" id="uv-index-bar" style="display: none;">
          <div class="uv-icon-wrapper">
            <i class="fas fa-sun uv-sun-icon" id="uv-sun-icon"></i>
          </div>
          <div class="uv-info">
            <div class="uv-label">UV-index</div>
            <div class="uv-value" id="uv-value">--</div>
          </div>
          <div class="uv-risk-info">
            <div class="uv-risk-text" id="uv-risk-text">--</div>
          </div>
        </div>

        <!-- NYTT: NEDERB√ñRDSBAR (visas endast vid nederb√∂rd) -->
        <div class="precipitation-bar" id="precipitation-bar" style="display: none;">
          <div class="precipitation-header">
            <i class="wi wi-raindrops precipitation-icon"></i>
            <span class="precipitation-title">NEDERB√ñRD KOMMANDE 2 TIMMAR</span>
          </div>
          
          <div class="precipitation-info">
            <div class="precipitation-text">
              <span class="precip-label">N√§sta timme:</span>
              <span class="precip-value" id="precip-next-hour">--</span>
              <span class="precip-separator">‚Ä¢</span>
              <span class="precip-label">Peak:</span>
              <span class="precip-value" id="precip-peak">--</span>
            </div>
          </div>
          
          <div class="precipitation-timeline">
            <div class="timeline-item">
              <div class="timeline-dots" id="timeline-dots-0">‚óè</div>
              <div class="timeline-time" id="timeline-time-0">Nu</div>
              <div class="timeline-value" id="timeline-value-0">--</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-dots" id="timeline-dots-1">‚óè</div>
              <div class="timeline-time" id="timeline-time-1">+1h</div>
              <div class="timeline-value" id="timeline-value-1">--</div>
            </div>
            <div class="timeline-item">
              <div class="timeline-dots" id="timeline-dots-2">‚óè</div>
              <div class="timeline-time" id="timeline-time-2">+2h</div>
              <div class="timeline-value" id="timeline-value-2">--</div>
            </div>
          </div>
          
          <div class="precipitation-description" id="precipitation-description">
            L√§tt regn
          </div>
        </div>
        <!-- SLUT: NEDERB√ñRDSBAR -->

        <!-- Omdesignade v√§derdetaljer med tydliga etiketter -->
        <div class="weather-details" id="weather-details">
          <div class="detail" data-card="wind">
            <div class="detail-icon">
              <!-- Vindikon som kan √§ndras baserat p√• vindskala -->
              <i id="wind-speed-icon" class="wi wi-strong-wind"></i>
            </div>
            <div class="detail-info">
              <div class="detail-label">Vind</div>
              <div class="detail-value" id="wind-speed">-- m/s</div>
            </div>
          </div>
          
          <div class="detail" data-card="direction">
            <div class="detail-icon">
              <!-- Anv√§nd 'from-' ist√§llet f√∂r 'towards-' f√∂r korrekt vindriktningsvisning -->
              <i class="wi wi-wind from-0-deg direction-icon"></i>
            </div>
            <div class="detail-info">
              <div class="detail-label">Riktning</div>
              <div class="detail-value" id="wind-direction">--</div>
            </div>
          </div>
          
          <!-- Lufttryckspanel med uppdaterad layout -->
          <div class="detail pressure-detail two-column-detail" data-card="pressure">
            <div class="pressure-left">
              <div class="detail-icon">
                <i class="wi wi-barometer"></i>
              </div>
              <div class="detail-info">
                <div class="detail-label">Lufttryck</div>
                <div class="detail-value" id="pressure-value">-- hPa</div>
              </div>
            </div>
            <div class="pressure-right">
              <div class="trend-container">
                <div class="trend-label">Trend</div>
                <div class="trend-value">
                  <i id="pressure-trend-icon" class="wi wi-direction-right"></i>
                  <span id="pressure-trend">Stabilt</span>
                </div>
                <div class="trend-description" id="pressure-trend-description">
                  Of√∂r√§ndrat v√§derl√§ge
                </div>
              </div>
            </div>
          </div>
          
          <!-- Soluppg√•ng och solnedg√•ng tillsammans men med separata gula ikoner -->
          <div class="detail sun-times" data-card="sun">
            <div class="sunrise-container">
              <div class="sun-label">Soluppg√•ng</div>
              <i class="wi wi-sunrise sun-icon"></i>
              <div class="time-value" id="sunrise-time">05:38</div>
            </div>
            <div class="sunset-container">
              <div class="sun-label">Solnedg√•ng</div>
              <i class="wi wi-sunset sun-icon"></i>
              <div class="time-value" id="sunset-time">19:59</div>
            </div>
          </div>
        </div>

        <!-- F√∂rb√§ttrad prognossektion - √§ndrad rubrik till 9-timmars prognos -->
        <div class="forecast-container">
          <h2>9-timmars prognos</h2>
          <div class="forecast" id="forecast-items">
            <!-- Fylls dynamiskt i JavaScript -->
          </div>
        </div>
        
        <!-- Dagsprognoser -->
        <div class="daily-forecast-container">
          <h2>4-dagarsprognos</h2>
          <div class="daily-forecast" id="daily-forecast-items">
            <!-- Fylls dynamiskt i JavaScript -->
          </div>
        </div>
      </div>

      <div class="error-message" id="error-message" style="display: none;">
        <span class="wi wi-na"></span>
        <p>Kunde inte ladda v√§derdata. F√∂rs√∂k igen senare.</p>
      </div>
      
      <!-- Inst√§llningspanel -->
      <div id="settings-panel" class="settings-panel" style="display: none;">
        <div class="settings-header">
          <h2>Inst√§llningar</h2>
          <button id="close-settings" class="close-button"><i class="fas fa-times"></i></button>
        </div>
        
        <!-- Platsv√§ljare flyttad till inst√§llningar -->
        <div class="setting-item">
          <label for="location-select">Plats:</label>
          <select id="location-select">
            <!-- Fylls dynamiskt fr√•n locations.js -->
          </select>
        </div>
        
        <div class="setting-item">
          <label for="api-key-input">IP Geolocation API-nyckel:</label>
          <input type="text" id="api-key-input" placeholder="Ange din API-nyckel h√§r">
          <p class="setting-description">Kr√§vs f√∂r att visa <strong>exakta tider</strong> f√∂r soluppg√•ng/solnedg√•ng. Utan API-nyckel anv√§nds en f√∂renklad ber√§kning som ger uppskattade tider. Skaffa en gratis nyckel p√• <a href="https://ipgeolocation.io/" target="_blank">ipgeolocation.io</a>.</p>
          <div class="api-key-status" id="api-key-status">
            <span id="api-key-icon" class="status-icon"><i class="fas fa-info-circle"></i></span>
            <span id="api-key-message">Soldata: Anv√§nder f√∂renklad ber√§kning</span>
          </div>
        </div>
        
        <!-- Anpassa kortlayout (flyttad hit) -->
        <div class="setting-item">
          <label>üìê Anpassa kortlayout</label>
          
          <div class="layout-settings">
            <div class="layout-option">
              <label>Position 1:</label>
              <select id="card-position-1">
                <option value="precipitation">Nederb√∂rd</option>
                <option value="uv">UV-index</option>
                <option value="wind">Vind + Vindriktning</option>
                <option value="pressure">Lufttryck + Trycktrend</option>
                <option value="sun">Soluppg√•ng/nedg√•ng</option>
              </select>
            </div>
            
            <div class="layout-option">
              <label>Position 2:</label>
              <select id="card-position-2">
                <option value="uv">UV-index</option>
                <option value="precipitation">Nederb√∂rd</option>
                <option value="wind">Vind + Vindriktning</option>
                <option value="pressure">Lufttryck + Trycktrend</option>
                <option value="sun">Soluppg√•ng/nedg√•ng</option>
              </select>
            </div>
            
            <div class="layout-option">
              <label>Position 3:</label>
              <select id="card-position-3">
                <option value="wind">Vind + Vindriktning</option>
                <option value="precipitation">Nederb√∂rd</option>
                <option value="uv">UV-index</option>
                <option value="pressure">Lufttryck + Trycktrend</option>
                <option value="sun">Soluppg√•ng/nedg√•ng</option>
              </select>
            </div>
            
            <div class="layout-option">
              <label>Position 4:</label>
              <select id="card-position-4">
                <option value="pressure">Lufttryck + Trycktrend</option>
                <option value="precipitation">Nederb√∂rd</option>
                <option value="uv">UV-index</option>
                <option value="wind">Vind + Vindriktning</option>
                <option value="sun">Soluppg√•ng/nedg√•ng</option>
              </select>
            </div>
            
            <div class="layout-option">
              <label>Position 5:</label>
              <select id="card-position-5">
                <option value="sun">Soluppg√•ng/nedg√•ng</option>
                <option value="precipitation">Nederb√∂rd</option>
                <option value="uv">UV-index</option>
                <option value="wind">Vind + Vindriktning</option>
                <option value="pressure">Lufttryck + Trycktrend</option>
              </select>
            </div>
            
            <button id="reset-layout" class="secondary-button">
              <i class="fas fa-undo"></i> √Öterst√§ll till standard
            </button>
          </div>
          
          <p class="setting-description">
            V√§lj ordning p√• v√§derkorten.
          </p>
        </div>
        
        <div class="setting-item">
          <label>Visa vindhastighet som:</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="wind-scale" value="ms"> 
              Meter per sekund (m/s)
            </label>
            <label class="radio-label">
              <input type="radio" name="wind-scale" value="beaufort" checked> 
              Beaufort-skala (0-12)
            </label>
            <label class="radio-label">
              <input type="radio" name="wind-scale" value="textsea"> 
              Beskrivande (Bris, Kuling, etc.)
            </label>
          </div>
        </div>
        
        <!-- Tryckenhet val -->
        <div class="setting-item">
          <label>Visa lufttryck som:</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="pressure-unit" value="hpa" checked> 
              Hektopascal (hPa)
            </label>
            <label class="radio-label">
              <input type="radio" name="pressure-unit" value="mbar"> 
              Millibar (mbar)
            </label>
            <label class="radio-label">
              <input type="radio" name="pressure-unit" value="mmhg"> 
              Millimeter kvicksilver (mmHg)
            </label>
          </div>
        </div>
        
        <!-- UV-index visning toggle -->
        <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="show-uv-index" checked>
            <span>Visa UV-index</span>
          </label>
          <p class="setting-description">Visar dagens maximala UV-index fr√•n CurrentUVIndex.com. Kr√§ver ingen API-nyckel.</p>
        </div>
        
        <!-- Spara-knapp -->
        <div class="setting-actions">
          <button id="save-settings" class="primary-button">Spara</button>
        </div>
        
        <!-- UV-index information -->
        <div class="setting-item uv-info-section">
          <h3><i class="fas fa-sun"></i> UV-index Information</h3>
          <div class="info-box">
            <p><strong>UV-index visar str√•lningens styrka fr√•n solen.</strong></p>
            <p>Data h√§mtas automatiskt fr√•n <a href="https://currentuvindex.com/" target="_blank">CurrentUVIndex.com</a> - en kostnadsfri tj√§nst som inte kr√§ver registrering eller API-nyckel.</p>
            
            <div class="uv-scale-guide">
              <p><strong>Riskniv√•er enligt Str√•ls√§kerhetsmyndigheten:</strong></p>
              <ul class="uv-levels-list">
                <li><span class="uv-dot uv-low"></span> <strong>0-2:</strong> L√•g UV-risk</li>
                <li><span class="uv-dot uv-moderate"></span> <strong>3-5:</strong> M√•ttlig UV-risk</li>
                <li><span class="uv-dot uv-high"></span> <strong>6-7:</strong> H√∂g UV-risk</li>
                <li><span class="uv-dot uv-very_high"></span> <strong>8-10:</strong> Mycket h√∂g UV-risk</li>
                <li><span class="uv-dot uv-extreme"></span> <strong>11+:</strong> Extrem UV-risk</li>
              </ul>
            </div>
            
            <p class="uv-note"><em>OBS: UV-index uppdateras var 6:e timme och cachar automatiskt. V√§rdet visar dagens f√∂rv√§ntade maximum.</em></p>
            
            <p class="uv-attribution">Data: <a href="https://currentuvindex.com/api" target="_blank">CurrentUVIndex.com API</a> (CC BY 4.0)</p>
          </div>
        </div>
        
        <!-- Nederb√∂rd information -->
        <div class="setting-item precipitation-info-section">
          <h3><i class="wi wi-raindrops"></i> Nederb√∂rd Information</h3>
          <div class="info-box">
            <p><strong>Nederb√∂rdsbaren visar prognos f√∂r kommande 2 timmar.</strong></p>
            <p>Data h√§mtas automatiskt fr√•n SMHI:s prognosAPI n√§r nederb√∂rd f√∂rv√§ntas.</p>
            
            <div class="precipitation-visibility-guide">
              <p><strong>N√§r visas nederb√∂rdsbaren?</strong></p>
              <ul class="precipitation-rules-list">
                <li><i class="fas fa-check-circle" style="color: #4caf50;"></i> <strong>Visas:</strong> N√§r nederb√∂rd ‚â• 0.1 mm/h f√∂rv√§ntas inom 2 timmar</li>
                <li><i class="fas fa-times-circle" style="color: #f44336;"></i> <strong>D√∂ljs:</strong> Vid uppeh√•ll eller l√§tt duggregn (&lt;0.1 mm/h)</li>
              </ul>
            </div>
            
            <div class="precipitation-scale-guide">
              <p><strong>F√§rgkodning enligt svensk standard:</strong></p>
              <ul class="precipitation-levels-list">
                <li><span class="precip-dot precip-drizzle"></span> <strong>&lt;0.1 mm/h:</strong> Duggregn (d√∂ljs)</li>
                <li><span class="precip-dot precip-light"></span> <strong>0.1-1 mm/h:</strong> L√§tt regn</li>
                <li><span class="precip-dot precip-moderate"></span> <strong>1-5 mm/h:</strong> M√•ttligt regn</li>
                <li><span class="precip-dot precip-heavy"></span> <strong>5-10 mm/h:</strong> Kraftigt regn</li>
                <li><span class="precip-dot precip-extreme"></span> <strong>&gt;10 mm/h:</strong> Skyfall</li>
              </ul>
            </div>
            
            <div class="precipitation-features-guide">
              <p><strong>Vad visas i baren?</strong></p>
              <ul class="precipitation-features-list">
                <li><strong>N√§sta timme:</strong> F√∂rv√§ntad nederb√∂rd kommande 60 minuter</li>
                <li><strong>Peak:</strong> H√∂gsta v√§rdet inom 2 timmar</li>
                <li><strong>Tidslinje:</strong> Visuell graf med f√§rgkodade prickar (‚óè) f√∂r Nu, +1h, +2h</li>
                <li><strong>Typ:</strong> Automatisk identifiering (regn/sn√∂/sn√∂blandat baserat p√• temperatur)</li>
                <li><strong>Trend:</strong> Visar om nederb√∂rden intensifieras eller avtar</li>
              </ul>
            </div>
            
            <p class="precipitation-note"><em>OBS: Nederb√∂rd uppdateras var 30:e minut tillsammans med √∂vrig v√§derdata. Prickarnas antal (1-4) visar intensitet.</em></p>
            
            <p class="precipitation-attribution">Data: <a href="https://opendata.smhi.se/" target="_blank">SMHI √ñppna Data</a> (CC0 1.0)</p>
          </div>
        </div>
        
        <!-- Attribution sektion -->
        <div class="setting-item attribution-section">
          <h3>Attribution</h3>
          <div class="attribution-box">
            <p><strong>V√§derikoner:</strong></p>
            <ul>
              <li>Weather Icons by <a href="https://github.com/erikflowers/weather-icons" target="_blank">Erik Flowers</a>, licensierad under <a href="https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=OFL" target="_blank">SIL OFL 1.1</a></li>
              <li>Animerade SVG v√§derikoner av <a href="https://www.amcharts.com/free-animated-svg-weather-icons/" target="_blank">amCharts</a>, licensierad under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International Public License</a></li>
            </ul>
            <p class="attribution-note">Detta inneb√§r att ikonerna kan anv√§ndas f√∂r kommersiellt bruk s√• l√§nge attribution ges till upphovsm√§nnen.</p>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>Data fr√•n SMHI. Uppdaterad: <span id="last-updated">--:--</span></p>
    </footer>
  </div>

  <script type="module" src="popup.js"></script>
</body>
</html>
